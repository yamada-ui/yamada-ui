pre-commit:
  piped: true
  jobs:
    - name: prettier
      glob: "*.{js,cjs,mjs,jsx,ts,cts,mts,tsx,d.ts,md,mdx,yaml,yml,json,html,css}"
      run: pnpm prettier {staged_files} --write
      stage_fixed: true

    - name: eslint
      group:
        parallel: true
        jobs:
          - name: root
            glob: "*.{js,cjs,mjs,jsx,ts,cts,mts,tsx,d.ts}"
            exclude:
              - packages/**
              - playgrounds/**
              - www/**
            run: |
              pnpm eslint {staged_files} --max-warnings=0 --fix --cache
            stage_fixed: true

          - name: cli
            root: packages/cli/
            glob: "*.{js,cjs,mjs,jsx,ts,cts,mts,tsx,d.ts}"
            run: |
              pnpm eslint {staged_files} --max-warnings=0 --fix --cache
            stage_fixed: true

          - name: react
            root: packages/react/
            glob: "*.{js,cjs,mjs,jsx,ts,cts,mts,tsx,d.ts}"
            run: |
              pnpm eslint {staged_files} --max-warnings=0 --fix --cache
            stage_fixed: true

          - name: utils
            root: packages/utils/
            glob: "*.{js,cjs,mjs,jsx,ts,cts,mts,tsx,d.ts}"
            run: |
              pnpm eslint {staged_files} --max-warnings=0 --fix --cache
            stage_fixed: true

          - name: workspace
            root: packages/workspace/
            glob: "*.{js,cjs,mjs,jsx,ts,cts,mts,tsx,d.ts}"
            run: |
              pnpm eslint {staged_files} --max-warnings=0 --fix --cache
            stage_fixed: true

          - name: www
            root: packages/www/
            glob: "*.{js,cjs,mjs,jsx,ts,cts,mts,tsx,d.ts}"
            run: |
              pnpm eslint {staged_files} --max-warnings=0 --fix --cache
            stage_fixed: true

          - name: next-app
            root: playgrounds/next/app/
            glob: "*.{js,cjs,mjs,jsx,ts,cts,mts,tsx,d.ts}"
            run: |
              pnpm eslint {staged_files} --max-warnings=0 --fix --cache
            stage_fixed: true

          - name: next-pages
            root: playgrounds/next/pages/
            glob: "*.{js,cjs,mjs,jsx,ts,cts,mts,tsx,d.ts}"
            run: |
              pnpm eslint {staged_files} --max-warnings=0 --fix --cache
            stage_fixed: true

          - name: react-router-framework
            root: playgrounds/react-router/framework/
            glob: "*.{js,cjs,mjs,jsx,ts,cts,mts,tsx,d.ts}"
            run: |
              pnpm eslint {staged_files} --max-warnings=0 --fix --cache
            stage_fixed: true

          - name: vite
            root: playgrounds/vite/
            glob: "*.{js,cjs,mjs,jsx,ts,cts,mts,tsx,d.ts}"
            run: |
              pnpm eslint {staged_files} --max-warnings=0 --fix --cache
            stage_fixed: true

commit-msg:
  commands:
    commitlint:
      run: |
        pnpm commitlint --edit {1}

post-merge:
  commands:
    pnpm:
      files: git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD
      glob: "{package.json,pnpm-lock.yaml}"
      run: pnpm install --frozen-lockfile

post-checkout:
  commands:
    pnpm:
      files: git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD
      glob: "{package.json,pnpm-lock.yaml}"
      run: pnpm install --frozen-lockfile
