import{r as t}from"./index-BwPxMuoB.js";import{s as z,a2 as A,n as H,O as P}from"./factory-DbNU74ts.js";const W=(c,i)=>{const e=getComputedStyle(c);return["auto","overlay","scroll"].includes(e.overflow)?!0:i?["auto","overlay","scroll"].includes(e.overflowY):["auto","overlay","scroll"].includes(e.overflowX)},C=({behavior:c,position:i,reverse:e,root:v,vertical:f})=>{let m;const p=P(v)&&W(v,f)?v:document.body;f?m={behavior:c,top:i??(e?p.scrollHeight:0)}:m={behavior:c,left:i??(e?p.scrollWidth:0)},p===document.body?window.scrollTo(m):p.scrollTo(m)},D=(c,i)=>{const e=P(c)&&W(c,i)?c:document.body;return i?e.scrollHeight-e.scrollTop:e.scrollWidth-e.scrollLeft},K=({behavior:c,isDisabled:i=!1,disabled:e=i,indexRef:v,initialLoad:f=!1,isReverse:m=!1,orientation:p="vertical",resetRef:L,reverse:o=m,rootMargin:O,rootRef:s,startIndex:U=f?0:1,threshold:T,onLoad:X}={})=>{const w=t.useRef(null),b=t.useRef(U),y=t.useRef(!1),S=t.useRef(void 0),h=t.useRef(!1),k=t.useRef(0),[Y,B]=t.useState(!1),g=z(X),a=p==="vertical",E=t.useMemo(()=>({root:s==null?void 0:s.current,rootMargin:O,threshold:T}),[O,s,T]),j=t.useCallback((u=1,n=!0)=>{if(b.current=u,B(!1),n){const l=s==null?void 0:s.current;C({behavior:c,reverse:o,root:l,vertical:a})}e||setTimeout(()=>{const l=S.current,r=w.current;r&&(l==null||l.observe(r))})},[e,o,s,a,c]),x=t.useCallback(()=>{const u=S.current,n=w.current;n&&(u==null||u.unobserve(n)),B(!0)},[]),I=t.useCallback(()=>new IntersectionObserver(async([n])=>{if(!(n!=null&&n.isIntersecting)||y.current)return;const l={entry:n,finish:x,index:b.current};y.current=!0;const r=s==null?void 0:s.current;if(r&&(r.ariaBusy="true"),o&&(k.current=D(r,a)),await g(l),o){const d=k.current;C({position:d,root:r,vertical:a})}b.current+=1,y.current=!1,r&&(r.ariaBusy="false")},E),[x,g,E,s,o,a]);return t.useEffect(()=>{(async()=>{const n=w.current,l=h.current,r=b.current,d=s==null?void 0:s.current;if(f&&!l&&(y.current=!0,d&&(d.ariaBusy="true"),await g({finish:x,index:r}),b.current+=1,y.current=!1,d&&(d.ariaBusy="false")),e)return;S.current=I();const F=S.current;if(o&&!l){const q=s==null?void 0:s.current;C({reverse:o,root:q,vertical:a}),h.current=!0}return setTimeout(()=>{n&&F.observe(n)}),()=>{n&&F.unobserve(n)}})()},[I,f,e,o,a,x,g,s]),A(()=>h.current=!1),H(L,j),H(v,u=>b.current=u),{ref:w,finish:Y}};export{K as u};
