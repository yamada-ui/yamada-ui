import{j as c}from"./jsx-runtime-CfatFE5O.js";import{u as le}from"./index-rZyt8EED.js";import{r as e}from"./index-ClcD9ViR.js";import{P as me,b as fe}from"./popover-trigger-kCg_5LKg.js";import{a as de}from"./use-component-style-B--WxH8d.js";import{o as xe}from"./theme-provider-r-UN7Xzc.js";import{B as H,o as ee,a2 as pe,a5 as Q,a as ne,h as N,as as _e,b as U,c as T,d as Me,av as Ce}from"./factory-D0ba2aB7.js";import{u as ye}from"./index-D0l_ls7Z.js";import{f as K}from"./forward-ref-D13m8o2p.js";import{c as be}from"./index-BWwQf8_A.js";const{DescendantsContextProvider:ve,useDescendant:Ie,useDescendants:ke,useDescendantsContext:he}=be(),[Re,z]=H({name:"MenuContext",errorMessage:`useMenu returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />"`}),[Be,De]=H({name:"ContextMenuContext",strict:!1}),[we,Fe]=H({name:"UpstreamMenuContext",strict:!1}),[je,te]=H({name:"UpstreamMenuItemContext",strict:!1}),ge=r=>{const{styles:i}=De()??{},[o,x]=de("Menu",r,{isProcessSkip:!!i,styles:i}),{relatedRef:m,onDownstreamCloseMapRef:C,onUpstreamClose:t}=Fe()??{},f=!!m,{closeOnBlur:d=!f,closeOnSelect:R=!0,duration:p=.2,initialFocusRef:a,offset:g=f?[-8,8]:void 0,placement:O=f?"right-start":"bottom-start",onClose:_,onOpen:y,...D}=xe(x),{hasDownstreamRef:v,setDownstreamOpen:l}=te()??{},I=ke(),[n,M]=e.useState(-1),k=e.useRef(null),P=e.useRef(null),S=e.useRef(new Set([])),G=e.useRef(null),w=e.useRef(new Map),A=e.useCallback(()=>{requestAnimationFrame(()=>{var s;return(s=k.current)==null?void 0:s.focus({preventScroll:!1})})},[]),V=e.useCallback(()=>{const s=setTimeout(()=>{if(a)return;const j=I.enabledFirstValue();j&&M(j.index)});S.current.add(s)},[I,a]),E=e.useCallback(()=>{const s=setTimeout(()=>{if(a)return;const j=I.enabledLastValue();j&&M(j.index)});S.current.add(s)},[I,a]),q=e.useCallback(()=>{y==null||y(),f||A()},[y,f,A]),J=e.useCallback(()=>{_==null||_();for(const s of w.current.values())s()},[_]),b=e.useId(),{open:F,onClose:h,onOpen:B}=le({...r,onClose:J,onOpen:q});return e.useEffect(()=>{const s=C==null?void 0:C.current;return s==null||s.set(b,h),()=>{s==null||s.delete(b)}},[b,h,C]),e.useEffect(()=>{l&&l(F)},[l,F]),e.useEffect(()=>(v&&(v.current=!0),()=>{v&&(v.current=!1)})),ee(()=>{F||M(-1)},[F]),pe(()=>{S.current.forEach(s=>clearTimeout(s)),S.current.clear()}),c.jsx(ve,{value:I,children:c.jsx(we,{value:{relatedRef:k,onDownstreamCloseMapRef:w,onUpstreamClose:Q(t,h)},children:c.jsx(Re,{value:{buttonRef:P,closeOnSelect:R,focusedIndex:n,menuRef:k,nested:f,open:F,requestAnimationFrameId:G,setFocusedIndex:M,styles:o,onClose:h,onFocusFirstItem:V,onFocusLastItem:E,onOpen:B,onUpstreamClose:t},children:c.jsx(me,{trigger:f?"hover":"click",...D,closeOnBlur:d,closeOnButton:!1,duration:p,initialFocusRef:a,offset:g,open:F,placement:O,relatedRef:m,onClose:h,onOpen:B})})})})};ge.__ui__="Menu";const Oe=r=>{var i;return Ce(r)&&!!((i=r.getAttribute("role"))!=null&&i.startsWith("menuitem"))},X=K(({id:r,className:i,children:o,closeOnSelect:x,command:m,isDisabled:C,disabled:t=C,isFocusable:f,focusable:d=f,icon:R,...p},a)=>{var Z;const{closeOnSelect:g,focusedIndex:O,menuRef:_,nested:y,open:D,requestAnimationFrameId:v,setFocusedIndex:l,styles:I,onClose:n,onUpstreamClose:M}=z(),{onUpstreamRestoreFocus:k}=te()??{},[P,S]=e.useState(!1),G=e.useId(),w=e.useRef(null),A=e.useRef(!1),V=e.useRef(()=>{}),E=t&&!d,q=(Z=w.current)==null?void 0:Z.getAttribute("type"),J=q?q==="checkbox"?"menuitemcheckbox":"menuitemradio":"menuitem",{index:b,register:F}=Ie({disabled:E}),h=b===O,B={alignItems:"center",color:"inherit",display:"flex",flex:"0 0 auto",gap:"0.75rem",outline:0,textAlign:"start",textDecoration:"none",userSelect:"none",width:"100%",...I.item};r??(r=G);const s=e.useCallback(()=>{t||l(b)},[b,t,l]),j=e.useCallback(()=>{t||l(-1)},[l,t]),ce=e.useCallback(u=>{if(!Oe(u.currentTarget))return;const L=A.current;(x??(!L&&g))&&(n(),M==null||M())},[x,g,n,M]),ae=e.useCallback(()=>{l(b)},[l,b]),re=e.useCallback(()=>{var u;(u=w.current)==null||u.focus(),l(b)},[l,b]),ue=e.useCallback(u=>{u.key===" "&&(u.key=u.code);const $={ArrowLeft:y?Q(k,n):void 0,Space:A.current?void 0:Q(M,n)}[u.key];$&&(u.preventDefault(),u.stopPropagation(),$())},[y,k,n,M]),ie=ye({clickOnSpace:!1,focusOnClick:!1,...p,ref:ne(F,w,a),disabled:t,focusable:d,onClick:N(p.onClick,ce),onFocus:N(p.onFocus,ae),onKeyDown:N(p.onKeyDown,ue,V.current),onMouseLeave:N(p.onMouseLeave,j),onMouseOver:N(p.onMouseOver,s)});return ee(()=>{if(!D)return;const u=v.current;return h&&!E&&w.current?(u&&cancelAnimationFrame(u),v.current=requestAnimationFrame(()=>{var L;(L=w.current)==null||L.focus({preventScroll:!0}),v.current=null})):_.current&&!_e(_.current)&&_.current.focus({preventScroll:!0}),()=>{u&&cancelAnimationFrame(u)}},[h,E,_,D]),o=R||m?c.jsx(U.span,{style:{flex:1},children:o}):o,c.jsx(je,{value:{hasDownstreamRef:A,setDownstreamOpen:S,onKeyDownRef:V,onUpstreamRestoreFocus:re},children:c.jsxs(U.div,{id:r,className:T("ui-menu__item",i),"data-focus":Me(P),__css:B,...ie,role:J,tabIndex:!P&&h?0:-1,children:[R?c.jsx(W,{children:R}):null,o,m?c.jsx(Y,{children:m}):null]})})});X.displayName="MenuItem";X.__ui__="MenuItem";const se=K(({className:r,isChecked:i,checked:o=i,children:x,closeOnSelect:m=!1,icon:C,...t},f)=>c.jsxs(X,{ref:f,className:T("ui-menu__item--option",r),"aria-checked":o,closeOnSelect:m,...t,children:[C!==null?c.jsx(W,{opacity:o?1:0,children:C||c.jsx(Se,{})}):null,x]}));se.displayName="MenuOptionItem";se.__ui__="MenuOptionItem";const W=K(({className:r,...i},o)=>{const{styles:x}=z(),m={alignItems:"center",display:"inline-flex",flexShrink:0,fontSize:"0.85em",justifyContent:"center",...x.icon};return c.jsx(U.span,{ref:o,className:T("ui-menu__item__icon",r),"aria-hidden":!0,__css:m,...i})});W.displayName="MenuIcon";W.__ui__="MenuIcon";const Y=K(({className:r,...i},o)=>{const{styles:x}=z(),m={...x.command};return c.jsx(U.span,{ref:o,className:T("ui-menu__item__command",r),__css:m,...i})});Y.displayName="MenuCommand";Y.__ui__="MenuCommand";const Se=()=>c.jsx("svg",{height:"1em",viewBox:"0 0 14 14",width:"1em",children:c.jsx("polygon",{fill:"currentColor",points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"})}),oe=K(({className:r,children:i,contentProps:o,...x},m)=>{var l,I;const{buttonRef:C,focusedIndex:t,menuRef:f,setFocusedIndex:d,styles:R,onClose:p}=z(),a=he(),g=(l=a.value(t))==null?void 0:l.node.id,O=e.useCallback(()=>{const n=a.enabledNextValue(t);n&&d(n.index)},[a,t,d]),_=e.useCallback(()=>{const n=a.enabledPrevValue(t);n&&d(n.index)},[a,t,d]),y=e.useCallback(()=>{const n=a.enabledFirstValue();n&&d(n.index)},[a,d]),D=e.useCallback(()=>{const n=a.enabledLastValue();n&&d(n.index)},[a,d]),v=e.useCallback(n=>{const k={ArrowDown:t===-1?y:O,ArrowUp:t===-1?D:_,End:D,Escape:p,Home:y,Tab:p}[n.key];k&&(n.preventDefault(),k(n))},[t,p,y,D,O,_]);return c.jsx(fe,{as:"div",className:"ui-menu__content","aria-activedescendant":g,"aria-labelledby":(I=C.current)==null?void 0:I.id,role:"menu",__css:{...R.content},...o,onKeyDown:N(o==null?void 0:o.onKeyDown,v),children:c.jsx(U.div,{ref:ne(f,m),className:T("ui-menu__list",r),tabIndex:-1,__css:{...R.list},...x,children:i})})});oe.displayName="MenuList";oe.__ui__="MenuList";export{Be as C,W as M,z as a,ge as b,oe as c,X as d,De as e,se as f,te as u};
