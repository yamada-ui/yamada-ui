import{r as t}from"./index-BwDkhjyp.js";import{k as j,S as q,e as F,E as H}from"./factory-CtEVzbYf.js";const M=(r,e)=>{const n=getComputedStyle(r);return["auto","scroll","overlay"].includes(n.overflow)?!0:e?["auto","scroll","overlay"].includes(n.overflowY):["auto","scroll","overlay"].includes(n.overflowX)},k=({root:r,isVertical:e,isReverse:n,behavior:y,position:a})=>{let f;const p=H(r)&&M(r,e)?r:document.body;e?f={top:a??(n?p.scrollHeight:0),behavior:y}:f={left:a??(n?p.scrollWidth:0),behavior:y},p===document.body?window.scrollTo(f):p.scrollTo(f)},z=(r,e)=>{const n=H(r)&&M(r,e)?r:document.body;return e?n.scrollHeight-n.scrollTop:n.scrollWidth-n.scrollLeft},J=({orientation:r="vertical",rootRef:e,rootMargin:n,threshold:y,initialLoad:a=!1,startIndex:f=a?0:1,onLoad:p,resetRef:P,indexRef:W,isDisabled:w=!1,isReverse:o=!1,behavior:C}={})=>{const S=t.useRef(null),d=t.useRef(f),v=t.useRef(!1),g=t.useRef(void 0),h=t.useRef(!1),E=t.useRef(0),[U,T]=t.useState(!1),b=j(p),i=r==="vertical",B=t.useMemo(()=>({root:e==null?void 0:e.current,rootMargin:n,threshold:y}),[n,e,y]),X=t.useCallback((u=1,s=!0)=>{if(d.current=u,T(!1),s){const l=e==null?void 0:e.current;k({root:l,isVertical:i,isReverse:o,behavior:C})}w||setTimeout(()=>{const l=g.current,c=S.current;c&&(l==null||l.observe(c))})},[w,o,e,i,C]),x=t.useCallback(()=>{const u=g.current,s=S.current;s&&(u==null||u.unobserve(s)),T(!0)},[]),I=t.useCallback(()=>new IntersectionObserver(async([s])=>{if(!s.isIntersecting||v.current)return;const l={index:d.current,entry:s,finish:x};v.current=!0;const c=e==null?void 0:e.current;if(c&&(c.ariaBusy="true"),o&&(E.current=z(c,i)),await(b==null?void 0:b(l)),o){const m=E.current;k({root:c,isVertical:i,position:m})}d.current+=1,v.current=!1,c&&(c.ariaBusy="false")},B),[x,b,B,e,o,i]);return t.useEffect(()=>{(async()=>{const s=S.current,l=h.current,c=d.current,m=e==null?void 0:e.current;if(a&&!l&&(v.current=!0,m&&(m.ariaBusy="true"),await b({index:c,finish:x}),d.current+=1,v.current=!1,m&&(m.ariaBusy="false")),w)return;g.current=I();const O=g.current;if(o&&!l){const Y=e==null?void 0:e.current;k({root:Y,isVertical:i,isReverse:o}),h.current=!0}return setTimeout(()=>{s&&O.observe(s)}),()=>{s&&O.unobserve(s)}})()},[I,a,w,o,i,x,b,e]),q(()=>h.current=!1),F(P,X),F(W,u=>d.current=u),{ref:S,isFinish:U}};export{J as u};
