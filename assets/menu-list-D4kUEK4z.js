import{j as o}from"./jsx-runtime-Nms4Y4qS.js";import{r as e}from"./index-BwDkhjyp.js";import{c as ne}from"./index-azatzDXB.js";import{u as se}from"./index-DeN1XzU7.js";import{l as q,h as O,a as J,f as Q,ag as te,b as L,c as N,x as oe,aj as re,V as X,R as ce}from"./factory-CKqVSKj1.js";import{a as Y}from"./use-component-style-DIJQBRrz.js";import{o as Z}from"./theme-provider-BTK0d_tQ.js";import{u as ae}from"./index-BtctO16n.js";import{f as P}from"./forward-ref-DKTvpK5d.js";import{P as ue,b as le}from"./popover-content-CugxI10r.js";const[ie,fe]=q({strict:!1,name:"ContextMenuContext"}),Ue=r=>{const[n,i]=Y("ContextMenu",r),{...f}=Z(i);return o.jsx(ie,{value:{styles:n},children:o.jsx(_e,{trigger:"contextmenu",...f})})},[me,$]=q({strict:!1,name:"UpstreamMenuItemContext"}),de=r=>{var n;return re(r)&&!!((n=r==null?void 0:r.getAttribute("role"))!=null&&n.startsWith("menuitem"))},xe=P(({className:r,isDisabled:n,isFocusable:i,closeOnSelect:f,icon:u,command:v,children:l,...c},D)=>{const{focusedIndex:R,setFocusedIndex:t,isOpen:C,onClose:b,onUpstreamClose:d,closeOnSelect:h,menuRef:x,requestAnimationFrameId:s,isNested:I,styles:p}=B(),{onUpstreamRestoreFocus:M}=$()??{},S=n&&!i,k=e.useRef(null),g=e.useRef(!1),j=e.useRef(()=>{}),{index:y,register:T}=he({disabled:S}),[K,H]=e.useState(!1),A=y===R,z=e.useCallback(()=>{n||t(y)},[y,n,t]),W=e.useCallback(()=>{n||t(-1)},[t,n]),E=e.useCallback(m=>{if(!de(m.currentTarget))return;const U=g.current;(f??(!U&&h))&&(b(),d==null||d())},[f,h,b,d]),_=e.useCallback(()=>{t(y)},[t,y]),V=e.useCallback(()=>{var m;(m=k.current)==null||m.focus(),t(y)},[t,y]),w=e.useCallback(m=>{const G={ArrowLeft:I?X(M,b):void 0}[m.key];G&&(m.preventDefault(),m.stopPropagation(),G())},[M,b,I]),a=ae({focusOnClick:!1,...c,onClick:O(c.onClick,E),onFocus:O(c.onFocus,_),onMouseOver:O(c.onMouseOver,z),onMouseLeave:O(c.onMouseLeave,W),onKeyDown:O(c.onKeyDown,w,j.current),ref:J(T,k,D),isDisabled:n,isFocusable:i});Q(()=>{if(!C)return;const m=s.current;return A&&!S&&k.current?(m&&cancelAnimationFrame(m),s.current=requestAnimationFrame(()=>{var U;(U=k.current)==null||U.focus({preventScroll:!0}),s.current=null})):x.current&&!te(x.current)&&x.current.focus({preventScroll:!0}),()=>{m&&cancelAnimationFrame(m)}},[A,S,x,C]),l=u||v?o.jsx(L.span,{style:{flex:1},children:l}):l;const F={textDecoration:"none",color:"inherit",userSelect:"none",display:"flex",width:"100%",alignItems:"center",textAlign:"start",flex:"0 0 auto",outline:0,gap:"0.75rem",...p.item};return o.jsx(me,{value:{onKeyDownRef:j,onUpstreamRestoreFocus:V,setDownstreamOpen:H,hasDownstreamRef:g},children:o.jsxs(L.li,{...a,...K?{"data-active":""}:{},role:"menuitem",tabIndex:A?0:-1,className:N("ui-menu__item",r),__css:F,children:[u?o.jsx(ee,{children:u}):null,l,v?o.jsx(Ce,{children:v}):null]})})}),Le=P(({className:r,icon:n,isChecked:i,closeOnSelect:f=!1,children:u,...v},l)=>o.jsxs(xe,{ref:l,className:N("ui-menu__item--option",r),"aria-checked":oe(i),closeOnSelect:f,...v,children:[n!==null?o.jsx(ee,{opacity:i?1:0,children:n||o.jsx(pe,{})}):null,u]})),ee=P(({className:r,...n},i)=>{const{styles:f}=B(),u={flexShrink:0,display:"inline-flex",justifyContent:"center",alignItems:"center",fontSize:"0.85em",...f.icon};return o.jsx(L.span,{ref:i,className:N("ui-menu__item__icon",r),__css:u,...n})}),Ce=P(({className:r,...n},i)=>{const{styles:f}=B(),u={...f.command};return o.jsx(L.span,{ref:i,className:N("ui-menu__item__command",r),__css:u,...n})}),pe=()=>o.jsx("svg",{viewBox:"0 0 14 14",width:"1em",height:"1em",children:o.jsx("polygon",{fill:"currentColor",points:"5.5 11.9993304 14 3.49933039 12.5 2 5.5 8.99933039 1.5 4.9968652 0 6.49933039"})}),{DescendantsContextProvider:Me,useDescendantsContext:ve,useDescendants:be,useDescendant:he}=ne(),[ke,B]=q({name:"MenuContext",errorMessage:`useMenu returned is 'undefined'. Seems you forgot to wrap the components in "<Menu />"`}),[ye,Ie]=q({strict:!1,name:"UpstreamMenuContext"}),_e=r=>{const{styles:n}=fe()??{},[i,f]=Y("Menu",r,{isProcessSkip:!!n,styles:n});let{initialFocusRef:u,closeOnSelect:v=!0,closeOnBlur:l,placement:c,duration:D=.2,offset:R,onOpen:t,onClose:C,...b}=Z(f);const{relatedRef:d,onUpstreamClose:h,onDownstreamCloseMapRef:x}=Ie()??{},{setDownstreamOpen:s,hasDownstreamRef:I}=$()??{},p=!!d;p?(c??(c="right-start"),R??(R=[-8,8]),l??(l=!1)):c??(c="bottom-start");const M=be(),[S,k]=e.useState(-1),g=e.useRef(null),j=e.useRef(new Set([])),y=e.useRef(null),T=e.useRef(new Map),K=e.useCallback(()=>{requestAnimationFrame(()=>{var a;return(a=g.current)==null?void 0:a.focus({preventScroll:!1})})},[]),H=e.useCallback(()=>{const a=setTimeout(()=>{if(u)return;const F=M.enabledFirstValue();F&&k(F.index)});j.current.add(a)},[M,u]),A=e.useCallback(()=>{const a=setTimeout(()=>{if(u)return;const F=M.enabledLastValue();F&&k(F.index)});j.current.add(a)},[M,u]),z=e.useCallback(()=>{t==null||t(),p||K()},[t,p,K]),W=e.useCallback(()=>{C==null||C();for(const a of T.current.values())a()},[C]),E=e.useId(),{isOpen:_,onOpen:V,onClose:w}=se({...r,onOpen:z,onClose:W});return e.useEffect(()=>{const a=x==null?void 0:x.current;return a==null||a.set(E,w),()=>{a==null||a.delete(E)}},[E,w,x]),e.useEffect(()=>{s&&s(_)},[s,_]),e.useEffect(()=>(I&&(I.current=!0),()=>{I&&(I.current=!1)})),Q(()=>{_||k(-1)},[_]),ce(()=>{j.current.forEach(a=>clearTimeout(a)),j.current.clear()}),o.jsx(Me,{value:M,children:o.jsx(ye,{value:{relatedRef:g,onDownstreamCloseMapRef:T,onUpstreamClose:X(h,w)},children:o.jsx(ke,{value:{isOpen:_,onOpen:V,onClose:w,onUpstreamClose:h,onFocusFirstItem:H,onFocusLastItem:A,closeOnSelect:v,focusedIndex:S,setFocusedIndex:k,menuRef:g,requestAnimationFrameId:y,isNested:p,styles:i},children:o.jsx(ue,{trigger:p?"hover":"click",...b,isOpen:_,onOpen:V,onClose:w,placement:c,offset:R,duration:D,initialFocusRef:u,relatedRef:d,closeOnButton:!1,closeOnBlur:l})})})})},Ne=P(({className:r,contentProps:n,children:i,...f},u)=>{const{menuRef:v,focusedIndex:l,setFocusedIndex:c,onClose:D,styles:R}=B(),t=ve(),C=e.useCallback(()=>{const s=t.enabledNextValue(l);s&&c(s.index)},[t,l,c]),b=e.useCallback(()=>{const s=t.enabledPrevValue(l);s&&c(s.index)},[t,l,c]),d=e.useCallback(()=>{const s=t.enabledFirstValue();s&&c(s.index)},[t,c]),h=e.useCallback(()=>{const s=t.enabledLastValue();s&&c(s.index)},[t,c]),x=e.useCallback(s=>{const p={Tab:M=>M.preventDefault(),Escape:D,ArrowDown:l===-1?d:C,ArrowUp:l===-1?h:b,Home:d,End:h}[s.key];p&&(s.preventDefault(),p(s))},[l,D,d,h,C,b]);return o.jsx(le,{as:"div",className:"ui-menu__content",__css:{...R.content},...n,onKeyDown:O(n==null?void 0:n.onKeyDown,x),children:o.jsx(L.ul,{ref:J(v,u),role:"menu",className:N("ui-menu__list",r),tabIndex:-1,__css:{...R.list},...f,children:i})})});export{Ue as C,ee as M,B as a,_e as b,Ne as c,xe as d,fe as e,Le as f,$ as u};
