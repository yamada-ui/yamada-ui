import{r as s}from"./index-BwDkhjyp.js";import{k as j,S as q,e as F,E as H}from"./factory-CJjTzqIw.js";const M=(r,e)=>{const n=getComputedStyle(r);return["auto","scroll","overlay"].includes(n.overflow)?!0:e?["auto","scroll","overlay"].includes(n.overflowY):["auto","scroll","overlay"].includes(n.overflowX)},k=({root:r,isVertical:e,isReverse:n,behavior:m,position:a})=>{let f;const p=H(r)&&M(r,e)?r:document.body;e?f={top:a??(n?p.scrollHeight:0),behavior:m}:f={left:a??(n?p.scrollWidth:0),behavior:m},p===document.body?window.scrollTo(f):p.scrollTo(f)},z=(r,e)=>{const n=H(r)&&M(r,e)?r:document.body;return e?n.scrollHeight-n.scrollTop:n.scrollWidth-n.scrollLeft},G=({orientation:r="vertical",rootRef:e,rootMargin:n,threshold:m,initialLoad:a=!1,startIndex:f=a?0:1,onLoad:p,resetRef:P,indexRef:W,isDisabled:y=!1,isReverse:l=!1,behavior:C}={})=>{const w=s.useRef(null),d=s.useRef(f),v=s.useRef(!1),S=s.useRef(void 0),h=s.useRef(!1),E=s.useRef(0),[U,T]=s.useState(!1),b=j(p),o=r==="vertical",I=s.useMemo(()=>({root:e==null?void 0:e.current,rootMargin:n,threshold:m}),[n,e,m]),X=s.useCallback((c=1,t=!0)=>{if(d.current=c,T(!1),t){const u=e==null?void 0:e.current;k({root:u,isVertical:o,isReverse:l,behavior:C})}y||setTimeout(()=>{const u=S.current,i=w.current;i&&(u==null||u.observe(i))})},[y,l,e,o,C]),g=s.useCallback(()=>{const c=S.current,t=w.current;t&&(c==null||c.unobserve(t)),T(!0)},[]),O=s.useCallback(()=>new IntersectionObserver(async([t])=>{if(!t.isIntersecting||v.current)return;const u={index:d.current,entry:t,finish:g};v.current=!0;const i=e==null?void 0:e.current;if(l&&(E.current=z(i,o)),await(b==null?void 0:b(u)),l){const x=E.current;k({root:i,isVertical:o,position:x})}d.current+=1,v.current=!1},I),[g,b,I,e,l,o]);return s.useEffect(()=>{(async()=>{const t=w.current,u=h.current,i=d.current;if(a&&!u&&(v.current=!0,await b({index:i,finish:g}),d.current+=1,v.current=!1),y)return;S.current=O();const x=S.current;if(l&&!u){const Y=e==null?void 0:e.current;k({root:Y,isVertical:o,isReverse:l}),h.current=!0}return setTimeout(()=>{t&&x.observe(t)}),()=>{t&&x.unobserve(t)}})()},[O,a,y,l,o,g,b,e]),q(()=>h.current=!1),F(P,X),F(W,c=>d.current=c),{ref:w,isFinish:U}};export{G as u};
